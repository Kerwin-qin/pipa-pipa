import React, { useState, useEffect } from 'react';
import { 
  MessageCircle, 
  Check, 
  Copy, 
  ChevronRight, 
  Music, 
  Star,
  Menu,
  X,
  Scroll
} from 'lucide-react';
import { motion, AnimatePresence } from 'framer-motion';

// --- Oriental Design Tokens (东方色卡) ---
const COLORS = {
  bg: "#fdfbf7",    // 宣纸白 Rice Paper
  ink: "#1a1a1a",   // 焦墨 Charcoal
  lightInk: "#575757", // 淡墨 Light Ink
  red: "#c63c26",   // 朱砂 Cinnabar
  gold: "#d4af37",  // 泥金 Matte Gold
  stone: "#e5e5e0", // 石色 Stone
  wash: "#E6E6E3",  // 渲染灰 Wash Grey
};

// --- Mock Data ---
const TESTIMONIALS = [
  {
    id: 1,
    text: "I never thought I could learn Pipa online. The instructor makes the complex techniques like 'Lunzhi' so accessible.",
    author: "Sarah J.",
    location: "London, UK"
  },
  {
    id: 2,
    text: "The aesthetic of the instrument and the sound is mesmerizing. Perfect for beginners.",
    author: "Mike T.",
    location: "New York, USA"
  }
];

// --- Components ---

// 1. Pipa Visual Art (纯 CSS/SVG 绘制的琵琶与意境图)
const PipaVisualArt = () => {
  return (
    <div className="w-full aspect-[4/5] bg-white rounded-2xl relative shadow-2xl overflow-hidden border border-[#e5e5e0] group">
      {/* 1. 背景纹理 (Noise Texture) */}
      <div className="absolute inset-0 opacity-20" style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.5'/%3E%3C/svg%3E")` }}></div>
      
      {/* 2. 金色满月 (Golden Moon) */}
      <motion.div 
        initial={{ scale: 0.8, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
        transition={{ duration: 1.5, ease: "easeOut" }}
        className="absolute top-12 right-8 w-24 h-24 rounded-full bg-[#d4af37]/20 blur-xl"
      ></motion.div>
      <div className="absolute top-16 right-12 w-16 h-16 rounded-full bg-[#d4af37] opacity-80 shadow-[0_0_40px_rgba(212,175,55,0.4)]"></div>

      {/* 3. 远山 (Distant Mountains) */}
      <div className="absolute bottom-0 left-0 right-0 h-48 opacity-30">
         <svg viewBox="0 0 100 20" preserveAspectRatio="none" className="w-full h-full text-[#1a1a1a]">
           <path d="M0 20 L20 10 Q30 5 40 10 T60 12 T100 5 L100 20 Z" fill="currentColor" />
         </svg>
      </div>
      <div className="absolute bottom-0 left-0 right-0 h-32 opacity-60">
         <svg viewBox="0 0 100 20" preserveAspectRatio="none" className="w-full h-full text-[#575757]">
           <path d="M0 20 L30 8 Q45 2 60 8 T100 15 L100 20 Z" fill="currentColor" />
         </svg>
      </div>

      {/* 4. 琵琶主体 (Pipa Vector Illustration) */}
      <motion.div 
        initial={{ y: 20, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        transition={{ delay: 0.3, duration: 1 }}
        className="absolute inset-0 flex items-center justify-center z-10"
      >
        <svg width="180" height="400" viewBox="0 0 180 400" fill="none" xmlns="http://www.w3.org/2000/svg" className="drop-shadow-2xl">
           {/* Body */}
           <path d="M90 380 C130 380 160 330 160 260 C160 190 110 120 98 60 L90 20 L82 60 C70 120 20 190 20 260 C20 330 50 380 90 380 Z" fill="#2A2A2A" stroke="#1a1a1a" strokeWidth="2"/>
           {/* Center Decoration (Rosewood inset) */}
           <path d="M90 360 C110 360 120 320 120 280 C120 240 90 240 90 240 C90 240 60 240 60 280 C60 320 70 360 90 360 Z" fill="#1a1a1a"/>
           {/* Strings (4 strings) */}
           <line x1="86" y1="40" x2="86" y2="340" stroke="#d4af37" strokeWidth="1" opacity="0.8"/>
           <line x1="88" y1="40" x2="88" y2="340" stroke="#d4af37" strokeWidth="1" opacity="0.8"/>
           <line x1="92" y1="40" x2="92" y2="340" stroke="#d4af37" strokeWidth="1" opacity="0.8"/>
           <line x1="94" y1="40" x2="94" y2="340" stroke="#d4af37" strokeWidth="1" opacity="0.8"/>
           {/* Bridge */}
           <rect x="70" y="330" width="40" height="6" fill="#4a3b32" rx="2" />
           {/* Head */}
           <rect x="80" y="10" width="20" height="30" fill="#2A2A2A" />
           <circle cx="78" cy="20" r="4" fill="#4a3b32" />
           <circle cx="102" cy="20" r="4" fill="#4a3b32" />
           <circle cx="78" cy="35" r="4" fill="#4a3b32" />
           <circle cx="102" cy="35" r="4" fill="#4a3b32" />
        </svg>
      </motion.div>

      {/* 5. 飘落的花瓣/印章 (Falling Petals & Seal) */}
      <div className="absolute top-8 left-8 w-8 h-20 border border-[#c63c26] opacity-80 flex items-center justify-center">
         <div className="writing-mode-vertical text-[#c63c26] font-serif text-xs font-bold tracking-widest pt-1">
            琵琶行
         </div>
      </div>
    </div>
  );
};

// 2. WeChat Widget (Conversion Tool)
const WeChatWidget = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [copied, setCopied] = useState(false);
  const WECHAT_ID = "PipaMasterLin888";

  const handleCopy = () => {
    navigator.clipboard.writeText(WECHAT_ID);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <>
      <button
        onClick={() => setIsOpen(true)}
        className="w-full py-4 bg-white border-2 border-[#1a1a1a] text-[#1a1a1a] rounded-lg font-medium flex items-center justify-center gap-2 hover:bg-[#f5f5f5] transition-colors shadow-[4px_4px_0px_0px_rgba(26,26,26,0.1)]"
      >
        <MessageCircle size={20} />
        Book Private Lesson (WeChat)
      </button>

      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm"
            onClick={() => setIsOpen(false)}
          >
            <motion.div
              initial={{ scale: 0.9, y: 20 }}
              animate={{ scale: 1, y: 0 }}
              exit={{ scale: 0.9, y: 20 }}
              onClick={(e) => e.stopPropagation()}
              className="bg-[#fdfbf7] p-6 rounded-xl max-w-xs w-full shadow-2xl relative border-t-4 border-[#c63c26]"
            >
              <button 
                onClick={() => setIsOpen(false)}
                className="absolute top-4 right-4 text-[#575757] hover:text-[#1a1a1a]"
              >
                <X size={20} />
              </button>

              <div className="text-center mb-6">
                <div className="w-12 h-12 bg-[#c63c26]/10 text-[#c63c26] rounded-full flex items-center justify-center mx-auto mb-3">
                  <MessageCircle size={24} />
                </div>
                <h3 className="font-serif text-xl font-bold text-[#1a1a1a]">Connect on WeChat</h3>
                <p className="text-sm text-[#575757] mt-1">Copy ID to add me for lessons.</p>
              </div>

              <div className="bg-white p-3 rounded-lg border border-[#e5e5e0] flex items-center justify-between mb-4">
                <span className="font-mono font-bold text-[#1a1a1a]">{WECHAT_ID}</span>
                <button
                  onClick={handleCopy}
                  className="text-[#c63c26] hover:text-[#a02e1b] p-2 hover:bg-red-50 rounded transition-colors"
                >
                  {copied ? <Check size={18} /> : <Copy size={18} />}
                </button>
              </div>

              {copied && (
                <motion.div 
                  initial={{ opacity: 0, y: -10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="text-center text-green-600 text-xs font-bold mb-4 bg-green-50 py-1 rounded"
                >
                  ID Copied! Open WeChat now.
                </motion.div>
              )}
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  );
};

// 3. Email Form (Lead Magnet)
const EmailForm = () => {
  const [email, setEmail] = useState("");
  const [status, setStatus] = useState("idle"); 

  const handleSubmit = (e) => {
    e.preventDefault();
    if (!email) return;
    setStatus("loading");
    setTimeout(() => {
      setStatus("success");
      setEmail("");
    }, 1500);
  };

  return (
    <div className="bg-[#1a1a1a] text-[#fdfbf7] p-6 rounded-xl relative overflow-hidden shadow-xl">
      <div className="absolute top-0 right-0 w-32 h-32 bg-[#c63c26] rounded-full blur-[60px] opacity-20 -mr-10 -mt-10 pointer-events-none"></div>
      
      {status === "success" ? (
        <motion.div 
          initial={{ opacity: 0 }} 
          animate={{ opacity: 1 }}
          className="text-center py-6"
        >
          <div className="w-12 h-12 bg-green-500/20 text-green-400 rounded-full flex items-center justify-center mx-auto mb-3">
            <Check size={24} />
          </div>
          <h3 className="font-serif text-xl mb-1">Sheet Music Sent!</h3>
          <p className="text-sm text-gray-400">Please check your inbox.</p>
        </motion.div>
      ) : (
        <>
          <div className="flex items-start gap-3 mb-4">
            <Scroll className="text-[#c63c26] mt-1 shrink-0" size={24} />
            <div>
              <h3 className="font-serif text-xl font-bold mb-1">Free Pipa Starter Pack</h3>
              <p className="text-sm text-gray-400 leading-relaxed">
                Get 3 beginner sheet music PDFs & introduction guide.
              </p>
            </div>
          </div>

          <form onSubmit={handleSubmit} className="flex flex-col gap-3">
            <input
              type="email"
              placeholder="Your Email Address"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder:text-gray-500 focus:outline-none focus:border-[#d4af37] transition-colors"
            />
            <button
              disabled={status === "loading"}
              className="w-full py-3 bg-[#c63c26] text-white font-medium rounded-lg hover:bg-[#b03522] transition-colors flex items-center justify-center gap-2"
            >
              {status === "loading" ? "Sending..." : <>Get It Now <ChevronRight size={16} /></>}
            </button>
          </form>
        </>
      )}
    </div>
  );
};

// --- Main App Component ---

export default function PipaLandingPage() {
  const [scrolled, setScrolled] = useState(false);

  useEffect(() => {
    const handleScroll = () => setScrolled(window.scrollY > 50);
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  return (
    <div className={`min-h-screen font-sans selection:bg-[#c63c26] selection:text-white relative`} style={{ backgroundColor: COLORS.bg }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap');
        .font-serif { font-family: 'Noto Serif SC', serif; }
        .writing-mode-vertical { writing-mode: vertical-rl; text-orientation: upright; }
      `}</style>

      {/* Global Background Noise Texture */}
      <div className="fixed inset-0 pointer-events-none opacity-40 z-0" style={{ backgroundImage: `url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.5'/%3E%3C/svg%3E")` }}></div>

      {/* Navbar */}
      <nav className={`fixed top-0 left-0 right-0 z-40 transition-all duration-300 ${scrolled ? 'bg-[#fdfbf7]/95 backdrop-blur-md shadow-sm py-3' : 'bg-transparent py-5'}`}>
        <div className="max-w-md mx-auto px-6 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 border border-[#1a1a1a] flex items-center justify-center rounded-full font-serif font-bold text-[#c63c26] bg-white shadow-sm text-sm">
              P
            </div>
            <span className="font-serif font-bold text-[#1a1a1a]">PIPA</span>
          </div>
          <button className="text-[#1a1a1a]">
            <Menu size={24} />
          </button>
        </div>
      </nav>

      {/* Mobile Container */}
      <main className="max-w-md mx-auto w-full relative overflow-hidden z-10 flex flex-col">
        
        {/* Background Decorative Ink Splashes */}
        <div className="absolute top-[-50px] right-[-100px] w-[300px] h-[300px] bg-[#d4af37]/10 rounded-full blur-[80px] pointer-events-none"></div>
        <div className="absolute top-[20%] left-[-50px] w-[200px] h-[200px] bg-gray-200/40 rounded-full blur-[60px] pointer-events-none"></div>

        {/* Hero Section */}
        <section className="pt-28 pb-12 px-6 flex flex-col items-center text-center relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6 }}
          >
            <div className="flex items-center justify-center gap-2 mb-4">
               <div className="h-[1px] w-8 bg-[#1a1a1a]/20"></div>
               <span className="text-[#1a1a1a] text-xs tracking-widest uppercase font-serif">The Sound of the Orient</span>
               <div className="h-[1px] w-8 bg-[#1a1a1a]/20"></div>
            </div>

            <h1 className="font-serif text-4xl md:text-5xl text-[#1a1a1a] leading-[1.15] mb-6">
              Find Inner Peace with <span className="text-[#c63c26] italic relative inline-block">
                Pipa
              </span>
            </h1>
            <p className="text-[#575757] text-lg mb-8 leading-relaxed font-light font-serif">
              Experience the 2,000-year-old healing music. <br/> From TikTok clips to professional mastery.
            </p>
          </motion.div>

          {/* New Pipa Visual Art Component */}
          <div className="w-full mb-10">
             <PipaVisualArt />
          </div>
          
          <div className="flex flex-col gap-3 w-full animate-fade-in-up">
            <button 
                onClick={() => document.getElementById('signup')?.scrollIntoView({ behavior: 'smooth' })}
                className="w-full py-4 bg-[#c63c26] text-white rounded-lg font-medium shadow-lg shadow-red-900/20 hover:bg-[#b03522] transition-colors flex items-center justify-center gap-2"
            >
                Start Your Journey <ChevronRight size={18}/>
            </button>
            <p className="text-xs text-[#575757] mt-1 font-serif italic">Join 5,000+ students worldwide</p>
          </div>
        </section>

        {/* Social Proof */}
        <section className="py-10 bg-white/50 backdrop-blur-sm border-y border-[#1a1a1a]/5">
          <div className="px-6">
            <h3 className="text-center font-serif text-[#1a1a1a] text-lg mb-6 flex items-center justify-center gap-2">
                <span className="text-[#c63c26]">✦</span> Loved by Students Globally
            </h3>
            
            <div className="flex flex-col gap-4">
              {TESTIMONIALS.map((item) => (
                <div key={item.id} className="bg-[#fdfbf7] p-5 rounded-lg border border-[#e5e5e0] relative shadow-sm">
                  <div className="absolute top-[-10px] left-4 bg-[#fdfbf7] px-2 text-[#d4af37] text-2xl font-serif">“</div>
                  <p className="text-[#1a1a1a] text-sm leading-relaxed mb-3 mt-1 italic font-serif">
                    {item.text}
                  </p>
                  <div className="flex items-center justify-between border-t border-[#1a1a1a]/5 pt-3">
                    <span className="text-xs font-bold text-[#1a1a1a]">{item.author}</span>
                    <span className="text-xs text-[#575757]">{item.location}</span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>

        {/* Features / Why Pipa */}
        <section className="py-16 px-6 relative">
          <div className="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-[#e5e5e0]/20 to-transparent pointer-events-none"></div>

          <h2 className="font-serif text-3xl text-[#1a1a1a] text-center mb-10">Why Learn Pipa?</h2>
          
          <div className="space-y-8 relative z-10">
            <div className="flex gap-5 items-start group">
              <div className="w-12 h-12 shrink-0 bg-[#1a1a1a] text-[#fdfbf7] rounded-full flex items-center justify-center font-serif font-bold text-xl shadow-lg group-hover:bg-[#c63c26] transition-colors">1</div>
              <div>
                <h3 className="font-bold text-[#1a1a1a] text-lg mb-2 font-serif">Mindfulness & Focus</h3>
                <p className="text-sm text-[#575757] leading-relaxed">Unlike western guitars, Pipa requires a unique connection between breath and finger movement. It is a meditative practice.</p>
              </div>
            </div>
            
            <div className="flex gap-5 items-start group">
              <div className="w-12 h-12 shrink-0 bg-[#1a1a1a] text-[#fdfbf7] rounded-full flex items-center justify-center font-serif font-bold text-xl shadow-lg group-hover:bg-[#c63c26] transition-colors">2</div>
              <div>
                <h3 className="font-bold text-[#1a1a1a] text-lg mb-2 font-serif">Cultural Bridge</h3>
                <p className="text-sm text-[#575757] leading-relaxed">Impress your friends with a 2000-year-old instrument that tells stories of ancient battles and tranquil rivers.</p>
              </div>
            </div>
          </div>
        </section>

        {/* Conversion Section (CTA) */}
        <section id="signup" className="py-12 px-6 relative">
           {/* Ink mountain Background Decoration */}
           <div className="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-[#e5e5e0] to-transparent opacity-50 z-0"></div>

           <div className="relative z-10">
             <div className="text-center mb-8">
               <h2 className="font-serif text-3xl text-[#1a1a1a] mb-3">Start Your Journey</h2>
               <p className="text-[#575757] italic font-serif">Choose how you want to connect.</p>
             </div>

             <div className="space-y-6">
               <EmailForm />
               
               <div className="relative flex py-2 items-center">
                  <div className="flex-grow border-t border-gray-300"></div>
                  <span className="flex-shrink mx-4 text-gray-400 text-xs uppercase tracking-wider font-serif">Or Direct Contact</span>
                  <div className="flex-grow border-t border-gray-300"></div>
               </div>

               <WeChatWidget />
             </div>
           </div>
        </section>

        {/* Footer */}
        <footer className="py-12 text-center bg-[#fdfbf7] relative">
            <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-24 h-[1px] bg-[#1a1a1a]/10"></div>
            
            <div className="w-16 h-16 border-2 border-[#c63c26] text-[#c63c26] rounded-sm flex items-center justify-center mx-auto mb-6 font-serif text-xl font-bold bg-white shadow-sm">
              PIPA
            </div>
            <p className="text-xs text-[#575757] mb-2 font-serif tracking-widest uppercase">PIPA Studio</p>
            <p className="text-[10px] text-[#575757]/60">© 2024 All Rights Reserved.</p>
            
            {/* Ink drop decoration */}
            <div className="w-2 h-2 rounded-full bg-[#1a1a1a] mx-auto mt-4 opacity-20"></div>
        </footer>

      </main>
    </div>
  );
}